@page "/"
@inject Blazored.LocalStorage.ILocalStorageService localStorage

<div class="row">
  <div class="col">
    <div class="card">
      <div class="card-header">
        Configuración
        <span class="oi oi-cog" aria-hidden="true" style="margin-top: 5px; float: right"></span>
      </div>
      <div class="card-body">
        <div class="alert alert-info" role="alert">
          <strong>Servidor: </strong>BigBlueButton
        </div>
        <form @onsubmit="HandleSubmit">
          <div class="form-group row mt-3">
            <label for="inputUrl" class="col-sm-2 offset-sm-1 col-form-label">URL Server:</label>
            <div class="col-sm-8">
              <input type="text" @bind="url" class="form-control" id="inputUrl" placeholder="ingrese url server...">
            </div>
          </div>
          <div class="form-group row">
            <label for="inputClave" class="col-sm-2 offset-sm-1 col-form-label">Clave: </label>
            <div class="col-sm-8">
              <input type="text" @bind="secret" class="form-control" id="inputClave" placeholder="ingrese clave...">
            </div>
          </div>
          <div class="form-group row">
            <div class="col-sm-11 text-right">
              <button type="button" @onclick="ResetForm" class="btn btn-secondary align-content-end"><span class="oi oi-x mr-2"></span>Limpiar</button>
              <button type="submit" class="btn btn-primary align-content-end"><span class="oi oi-check mr-2"></span>Guardar</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

@code {
  [Inject]
  protected Sotsera.Blazor.Toaster.IToaster Toaster { get; set; }

  private string url { get; set; } = "http://bbblisandro.duckdns.org/bigbluebutton/api";
  private string secret { get; set; } = "TM6I5tVVENQOLespdftbHQhF3M2SMYToOP7F4otJAc";
  private bool firstRender { get; set; } = true;

  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
    if (firstRender)
    {
      await localStorage.SetItemAsync("url", url);
      await localStorage.SetItemAsync("secret", secret);
      firstRender = false;
    }
  }

  public async Task HandleSubmit()
  {
    if (string.IsNullOrEmpty(url) || string.IsNullOrEmpty(secret))
    {
      Toaster.Warning("Complete el formulario.", "Oops!");
    }
    else
    {
      await localStorage.SetItemAsync("url", url);
      await localStorage.SetItemAsync("secret", secret);

      Toaster.Success("Datos almacenados.", "Wooh!");
    }
  }

  public void ResetForm()
  {
    this.url = "";
    this.secret = "";
  }
}
